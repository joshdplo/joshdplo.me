---
import recents from "@recents";
import { getEmojiFromCategory } from "@util";
import { getCollection } from "astro:content";
import BaseLayout from "@layouts/BaseLayout.astro";
import HeroText from "@components/HeroText.svelte";
import NoteCard from "@components/NoteCard.astro";
import CollectionItem from "@components/CollectionItem.astro";

const notes = await getCollection("notes");
const sortedNotes = notes.sort(
	(a, b) =>
		new Date(b.data.updated || b.data.date) -
		new Date(a.data.updated || a.data.date),
);
---

<BaseLayout pageTitle="Home">
	<section class="contain">
		<div class="center-full">
			<HeroText text="JOSH" size={20} />
		</div>

		<p class="h2 border-opposite bg">
			Hi -
			<span class="bg-accent no-pad">welcome to my website!</span> I use it to
			<span class="bg-secondary no-pad"
				><a href="/likes">list some of the things I like</a></span
			> and
			<span class="bg-quaternary no-pad"
				><a href="/notes">write down a few notes</a></span
			>. Maybe we have some favorites in common :)
		</p>
	</section>

	<section class="contain featured">
		<div class="box notes">
			<h2>
				{getEmojiFromCategory("notes")} Latest Notes
			</h2>
			<div class="inner">
				<NoteCard data={sortedNotes[0]} />
				<NoteCard data={sortedNotes[1]} />
			</div>
		</div>
		<div class="box movies">
			<h2>
				{getEmojiFromCategory("movies")} Recently Watched
			</h2>
			<div class="inner">
				{
					recents.watched.map(
						(r) =>
							r?.active && (
								<CollectionItem category={r.category} itemId={r.itemId} />
							),
					)
				}
			</div>
		</div>
		<div class="box shows">
			<h2>
				{getEmojiFromCategory("shows")} Current Shows
			</h2>
			<div class="inner">
				{
					recents.shows.map(
						(r) =>
							r?.active && (
								<CollectionItem category={r.category} itemId={r.itemId} />
							),
					)
				}
			</div>
		</div>
		<div class="box music">
			<h2>
				{getEmojiFromCategory("bands")} Been Jamming To
			</h2>
			<div class="inner">
				{
					recents.music.map(
						(r) =>
							r?.active && (
								<CollectionItem category={r.category} itemId={r.itemId} />
							),
					)
				}
			</div>
		</div>
		<div class="box games">
			<h2>
				{getEmojiFromCategory("games")} Having Fun Playing
			</h2>
			<div class="inner">
				{
					recents.games.map(
						(r) =>
							r?.active && (
								<CollectionItem category={r.category} itemId={r.itemId} />
							),
					)
				}
			</div>
		</div>
	</section>
</BaseLayout>

<style lang="scss">
	@use "@css/util";

	.h2 {
		margin: 1.5rem 0 3rem;
		line-height: 1.3;
	}

	.featured {
		display: grid;
		grid-template-columns: 1fr;
		gap: 3rem;
		margin-top: 2.5rem;
	}

	.box {
		display: flex;
		flex-direction: column;
		gap: 0.7rem;

		.inner {
			display: grid;
			grid-template-columns: 1fr;
			gap: 1rem;

			:global(.collection-item) {
				margin: 0;
			}

			@include util.mq(sm) {
				grid-template-columns: 1fr 1fr;
			}
		}
	}

	.notes {
		:global(.card) {
			border: 3px solid var(--content-subtle);
			border-radius: 0.15rem;
			padding: 0.7rem;
		}
	}

	.shows .inner {
	}
</style>
